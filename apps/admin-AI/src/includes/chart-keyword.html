<div class="chart-view has-grid">
  <div id="chatChart" style="width: 100%; height: 100%;"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const chartDom = document.getElementById('chatChart');
    let myChart = echarts.init(chartDom);

    // 색상 정의
    const colors = {
      positive: '#0096FF', // 긍정 - 파란색
      neutral: '#F2B84B',   // 중립 - 노란색/주황색
      negative: '#E55765'  // 부정 - 빨간색
    };

    // 키워드 더미 데이터 생성
    const keywords = [
      // 긍정 키워드
      { name: '만족', value: 85, sentiment: 'positive' },
      { name: '좋음', value: 75, sentiment: 'positive' },
      { name: '친절', value: 70, sentiment: 'positive' },
      { name: '빠름', value: 65, sentiment: 'positive' },
      { name: '도움', value: 60, sentiment: 'positive' },
      { name: '감사', value: 55, sentiment: 'positive' },
      { name: '편리', value: 50, sentiment: 'positive' },
      { name: '추천', value: 45, sentiment: 'positive' },

      // 중립 키워드
      { name: '문의', value: 80, sentiment: 'neutral' },
      { name: '확인', value: 70, sentiment: 'neutral' },
      { name: '안내', value: 65, sentiment: 'neutral' },
      { name: '처리', value: 60, sentiment: 'neutral' },
      { name: '상담', value: 55, sentiment: 'neutral' },
      { name: '접수', value: 50, sentiment: 'neutral' },
      { name: '검토', value: 45, sentiment: 'neutral' },
      { name: '대기', value: 40, sentiment: 'neutral' },

      // 부정 키워드
      { name: '불만', value: 90, sentiment: 'negative' },
      { name: '지연', value: 85, sentiment: 'negative' },
      { name: '오류', value: 80, sentiment: 'negative' },
      { name: '불편', value: 75, sentiment: 'negative' },
      { name: '답답', value: 70, sentiment: 'negative' },
      { name: '느림', value: 65, sentiment: 'negative' },
      { name: '문제', value: 60, sentiment: 'negative' },
      { name: '불안', value: 55, sentiment: 'negative' }
    ];

    // 키워드 데이터를 워드클라우드 형식으로 변환
    const wordCloudData = keywords.map(function (item) {
      let color;
      if (item.sentiment === 'positive') {
        color = colors.positive;
      } else if (item.sentiment === 'neutral') {
        color = colors.neutral;
      } else {
        color = colors.negative;
      }

      return {
        name: item.name,
        value: item.value,
        textStyle: {
          color: color
        }
      };
    });

    const option = {
      animation: true,
      animationDuration: 2000,
      animationEasing: 'cubicOut',
      tooltip: {
        show: true,
        trigger: 'item',
        backgroundColor: 'rgba(21, 24, 26, 0.9)',
        borderRadius: 14,
        padding: [12, 16],
        textStyle: {
          color: '#fff',
          fontSize: 12
        },
        extraCssText: 'box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);',
        formatter: function (params) {
          return '<div style="padding: 2px 0;">' +
            '<div style="font-size: 14px; font-weight: 600; color: #fff;">' + params.name + '</div>' +
            '<div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-top: 4px;">빈도: ' + params.value + '</div>' +
            '</div>';
        }
      },
      series: [{
        type: 'wordCloud',
        gridSize: 40,
        sizeRange: [14, 70],
        rotationRange: [-0, 0],
        drawOutOfBound: false,
        layoutAnimation: {
          duration: 2000,
          easing: 'cubicOut'
        },
        textStyle: {
          fontFamily: 'Pretendard, sans-serif',
          fontWeight: 'bold',
          color: function () {
            return colors.positive;
          }
        },
        emphasis: {
          textStyle: {
            shadowBlur: 10,
            shadowColor: 'rgba(0, 0, 0, 0.3)'
          }
        },
        data: wordCloudData
      }]
    };

    // 초기에는 빈 배열로 시작
    myChart.setOption({
      series: [{
        type: 'wordCloud',
        gridSize: 40,
        sizeRange: [14, 70],
        rotationRange: [-0, 0],
        drawOutOfBound: false,
        textStyle: {
          fontFamily: 'Pretendard, sans-serif',
          fontWeight: 'bold',
          color: function () {
            return colors.positive;
          }
        },
        data: []
      }]
    }, true);

    // 키워드를 순차적으로 추가하여 애니메이션 효과
    let currentIndex = 0;
    const addKeyword = function () {
      if (currentIndex < wordCloudData.length) {
        const currentData = wordCloudData.slice(0, currentIndex + 1);
        myChart.setOption({
          series: [{
            data: currentData,
            animation: true,
            animationDuration: 600,
            animationEasing: 'cubicOut'
          }]
        }, false);
        currentIndex++;
        setTimeout(addKeyword, 40); // 40ms마다 하나씩 추가
      } else {
        // 모든 키워드 추가 완료 후 최종 레이아웃 조정
        myChart.setOption(option, false);
      }
    };

    // 약간의 딜레이 후 애니메이션 시작
    setTimeout(addKeyword, 200);

    window.addEventListener('resize', function () {
      myChart.resize();
    });

    $('.globalNav').on('click', function () {
      myChart.dispose();
      setTimeout(function () {
        const newChart = echarts.init(document.getElementById('chatChart'));
        newChart.setOption(option);
        myChart = newChart;
      }, 300); // GNB 애니메이션 완료 후 실행
    });
  });
</script>