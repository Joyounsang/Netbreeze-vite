<div class="chart-view">
  <div id="chatChart" style="width: 100%; height: 100%;"></div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const chartDom = document.getElementById('chatChart');
    let myChart = echarts.init(chartDom);

    // 전역 변수로 차트 인스턴스 저장
    // window.chatChartInstance = myChart;

    // 12주 날짜 생성
    const labels = ['10.10', '10.18', '10.26', '11.3', '11.11', '11.19', '11.27', '12.5', '12.13', '12.21', '12.29', '1.6'];

    // 랜덤 데이터 생성 함수
    function generateRandomData(count, min, max) {
      const data = [];
      for (let i = 0; i < count; i++) {
        data.push(Math.floor(Math.random() * (max - min + 1)) + min);
      }
      return data;
    }

    // 랜덤 샘플 데이터 생성 (데모 버전)
    const activeUserData = generateRandomData(12, 2000, 5000); // 활성 사용자 수
    const chatCountData = generateRandomData(12, 1500, 5000); // 채팅 건 수
    const avgChatData = generateRandomData(12, 2000, 6000); // 1인당 평균 채팅 건 수

    // 색상 정의
    const colors = {
      activeUser: { normal: 'rgba(0, 150, 255, 0.8)', hover: 'rgba(0, 150, 255, 1)', hex: '#0096FF' },
      chatCount: { normal: 'rgba(251, 113, 133, 0.8)', hover: 'rgba(251, 113, 133, 1)', hex: '#FB7185' },
      avgChat: { normal: 'rgba(0, 194, 168, 0.8)', hover: 'rgba(0, 194, 168, 1)', hex: '#00C2A8' }
    };

    const option = {
      animation: true,
      animationDuration: 1000,
      animationEasing: 'linear',
      grid: {
        left: '40px',
        right: 0,
        top: '10%',
        bottom: '10%',
        containLabel: false
      },
      xAxis: {
        type: 'category',
        data: labels,
        axisLine: {
          show: false
        },
        axisTick: {
          show: false
        },
        axisLabel: {
          show: true,
          color: '#7E8291',
          fontSize: 12
        },
        splitLine: {
          show: false
        }
      },
      yAxis: {
        type: 'value',
        min: 0,
        max: 8000,
        interval: 2000,
        axisLine: {
          show: false
        },
        axisTick: {
          show: false
        },
        axisLabel: {
          show: true,
          color: '#7E8291',
          formatter: function (value) {
            return value.toLocaleString();
          }
        },
        splitLine: {
          show: true,
          lineStyle: {
            color: '#DBE1E6',
            width: 1
          }
        }
      },
      tooltip: {
        trigger: 'axis',
        axisPointer: {
          type: 'line',
          lineStyle: {
            color: 'rgba(0, 0, 0, 0.1)',
            width: 1
          },
          label: {
            show: false
          }
        },
        backgroundColor: 'rgba(21, 24, 26, 0.9)',
        borderRadius: 14, // 라운딩 추가
        padding: [12, 16], // [상하, 좌우] 패딩
        textStyle: {
          color: '#fff',
          fontSize: 12 // 기본 폰트 크기
        },
        extraCssText: 'box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);', // 그림자 효과
        formatter: function (params) {
          // 커스텀 HTML로 툴팁 생성
          let html = '<div style="padding: 2px 0;">';
          html += '<div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-bottom: 6px;">' + params[0].axisValue + '</div>';

          params.forEach(function (item) {
            // lineStyle.color를 사용하거나, 시리즈 이름에 따라 색상 매칭
            let color = item.color;
            if (!color || color === 'transparent') {
              // lineStyle에서 색상 가져오기
              if (item.marker && item.marker.color) {
                color = item.marker.color;
              } else if (item.borderColor) {
                color = item.borderColor;
              } else {
                // 시리즈 이름에 따라 색상 지정
                if (item.seriesName === '활성 사용자 수') {
                  color = colors.activeUser.hex;
                } else if (item.seriesName === '채팅 건 수') {
                  color = colors.chatCount.hex;
                } else if (item.seriesName === '1인당 평균 채팅 건 수') {
                  color = colors.avgChat.hex;
                }
              }
            }
            html += '<div style="display: flex; align-items: center; margin-bottom: 4px;">';
            html += '<span style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background-color: ' + color + '; margin-right: 8px;"></span>';
            html += '<span style="font-size: 14px; font-weight: 600; color: #fff;">' + item.seriesName + ': ' + item.value.toLocaleString() + '</span>';
            html += '</div>';
          });

          html += '</div>';
          return html;
        }
      },
      series: [
        {
          name: '활성 사용자 수',
          type: 'line',
          smooth: 0.4,
          data: activeUserData,
          lineStyle: {
            color: colors.activeUser.normal,
            width: 2
          },
          itemStyle: {
            color: 'transparent',
            borderWidth: 0
          },
          symbol: 'circle',
          symbolSize: 0,
          emphasis: {
            focus: 'series',
            lineStyle: {
              color: colors.activeUser.hover,
              width: 2
            },
            itemStyle: {
              color: colors.activeUser.hex,
              borderColor: '#fff',
              borderWidth: 1,
              shadowBlur: 0
            },
            symbol: 'circle',
            symbolSize: 10
          },
          showSymbol: false
        },
        {
          name: '채팅 건 수',
          type: 'line',
          smooth: 0.4,
          data: chatCountData,
          lineStyle: {
            color: colors.chatCount.normal,
            width: 2
          },
          itemStyle: {
            color: 'transparent',
            borderWidth: 0
          },
          symbol: 'circle',
          symbolSize: 0,
          emphasis: {
            focus: 'series',
            lineStyle: {
              color: colors.chatCount.hover,
              width: 2
            },
            itemStyle: {
              color: colors.chatCount.hex,
              borderColor: '#fff',
              borderWidth: 1,
              shadowBlur: 0
            },
            symbol: 'circle',
            symbolSize: 10
          },
          showSymbol: false
        },
        {
          name: '1인당 평균 채팅 건 수',
          type: 'line',
          smooth: 0.4,
          data: avgChatData,
          lineStyle: {
            color: colors.avgChat.normal,
            width: 2
          },
          itemStyle: {
            color: 'transparent',
            borderWidth: 0
          },
          symbol: 'circle',
          symbolSize: 0,
          showSymbol: false
        }
      ]
    };

    myChart.setOption(option);

    window.addEventListener('resize', function () {
      myChart.resize();
    });

    $('.globalNav').on('click', function () {
      myChart.dispose();
      setTimeout(function () {
        const newChart = echarts.init(document.getElementById('chatChart'));
        newChart.setOption(option);
        myChart = newChart;
      }, 300); // GNB 애니메이션 완료 후 실행
    });
  });
</script>