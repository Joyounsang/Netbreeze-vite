<!DOCTYPE html>
<html lang="ko">
<include src="src/includes/head.html"></include>

<body>
    <div class="viewport">
        <include src="src/includes/header.html"></include>
        <div class="container">
            <include src="src/includes/GNB.html"></include>
            <div class="contents">
                <div class="panel scrollbar">
                    <div class="panel-dashboard">
                        <div class="panel-main">
                            <div class="row">
                                <div class="column aiHelperArea">
                                    <div class="netbreezeAi">
                                        <div class="ai-speak">
                                            <span>통화 관리</span>
                                            <p>
                                                긍정 키워드인 ‘행복하세요’
                                                가 급증하고 있습니다.
                                            </p>
                                        </div>

                                        <div class="netbreezeHelper">
                                            <span class="atom" style="background-color: #0096FF;"></span>
                                            <span class="atom" style="background-color: #FC8D9D;"></span>
                                            <span class="atom" style="background-color: #F5C66F;"></span>
                                            <span class="atom" style="background-color: #33CEB9;"></span>
                                        </div>
                                    </div>

                                    <ul class="mainChartsArea-label">
                                        <li class="charts-label">
                                            긍정
                                            <span class="dot" style="background-color: #0096FF;"></span>
                                        </li>
                                        <li class="charts-label">
                                            중립
                                            <span class="dot" style="background-color: #F2B84B;"></span>
                                        </li>
                                        <li class="charts-label">
                                            부정
                                            <span class="dot" style="background-color: #FF4F1A;"></span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="column mainChartsArea">
                                    <div class="headline">

                                        <div class="flt">
                                            <div class="title-lv1">통화 주요 키워드</div>
                                            <select style="width: 90px;">
                                                <option>7일</option>
                                            </select>
                                            <div class="input-date">
                                                <div class="include-ico">
                                                    <input id="sdate" class="datepicker" type="text">
                                                    <label for="sdate" class="ico cal" title="날짜선택"></label>
                                                </div>
                                                <span class="unit">-</span>
                                                <div class="include-ico">
                                                    <input id="edate" class="datepicker" type="text">
                                                    <label for="edate" class="ico cal" title="날짜선택"></label>
                                                </div>
                                            </div>
                                            <a href="#" class="btn icoLeft"><span class="ico excel"></span>다운로드</a>
                                        </div>
                                        <div class="cmd">
                                            <div class="button-tab">
                                                <a href="#" class="button-tab-item on">민원 통화</a>
                                                <a href="#" class="button-tab-item negative">위험 민원</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-view">
                                        <div id="chatChart" style="width: 100%; height: 100%;"></div>
                                    </div>
                                    <script
                                        src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
                                    <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            const chartDom = document.getElementById('chatChart');
                                            const myChart = echarts.init(chartDom);

                                            // 색상 정의
                                            const colors = {
                                                positive: '#0096FF', // 긍정 - 파란색
                                                neutral: '#F2B84B',   // 중립 - 노란색/주황색
                                                negative: '#E55765'  // 부정 - 빨간색
                                            };

                                            // 키워드 더미 데이터 생성
                                            const keywords = [
                                                // 긍정 키워드
                                                { name: '만족', value: 85, sentiment: 'positive' },
                                                { name: '좋음', value: 75, sentiment: 'positive' },
                                                { name: '친절', value: 70, sentiment: 'positive' },
                                                { name: '빠름', value: 65, sentiment: 'positive' },
                                                { name: '도움', value: 60, sentiment: 'positive' },
                                                { name: '감사', value: 55, sentiment: 'positive' },
                                                { name: '편리', value: 50, sentiment: 'positive' },
                                                { name: '추천', value: 45, sentiment: 'positive' },

                                                // 중립 키워드
                                                { name: '문의', value: 80, sentiment: 'neutral' },
                                                { name: '확인', value: 70, sentiment: 'neutral' },
                                                { name: '안내', value: 65, sentiment: 'neutral' },
                                                { name: '처리', value: 60, sentiment: 'neutral' },
                                                { name: '상담', value: 55, sentiment: 'neutral' },
                                                { name: '접수', value: 50, sentiment: 'neutral' },
                                                { name: '검토', value: 45, sentiment: 'neutral' },
                                                { name: '대기', value: 40, sentiment: 'neutral' },

                                                // 부정 키워드
                                                { name: '불만', value: 90, sentiment: 'negative' },
                                                { name: '지연', value: 85, sentiment: 'negative' },
                                                { name: '오류', value: 80, sentiment: 'negative' },
                                                { name: '불편', value: 75, sentiment: 'negative' },
                                                { name: '답답', value: 70, sentiment: 'negative' },
                                                { name: '느림', value: 65, sentiment: 'negative' },
                                                { name: '문제', value: 60, sentiment: 'negative' },
                                                { name: '불안', value: 55, sentiment: 'negative' }
                                            ];

                                            // 키워드 데이터를 워드클라우드 형식으로 변환
                                            const wordCloudData = keywords.map(function (item) {
                                                let color;
                                                if (item.sentiment === 'positive') {
                                                    color = colors.positive;
                                                } else if (item.sentiment === 'neutral') {
                                                    color = colors.neutral;
                                                } else {
                                                    color = colors.negative;
                                                }

                                                return {
                                                    name: item.name,
                                                    value: item.value,
                                                    textStyle: {
                                                        color: color
                                                    }
                                                };
                                            });

                                            const option = {
                                                animation: true,
                                                animationDuration: 2000,
                                                animationEasing: 'cubicOut',
                                                tooltip: {
                                                    show: true,
                                                    trigger: 'item',
                                                    backgroundColor: 'rgba(21, 24, 26, 0.9)',
                                                    borderRadius: 14,
                                                    padding: [12, 16],
                                                    textStyle: {
                                                        color: '#fff',
                                                        fontSize: 12
                                                    },
                                                    extraCssText: 'box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);',
                                                    formatter: function (params) {
                                                        return '<div style="padding: 2px 0;">' +
                                                            '<div style="font-size: 14px; font-weight: 600; color: #fff;">' + params.name + '</div>' +
                                                            '<div style="font-size: 12px; color: rgba(255, 255, 255, 0.7); margin-top: 4px;">빈도: ' + params.value + '</div>' +
                                                            '</div>';
                                                    }
                                                },
                                                series: [{
                                                    type: 'wordCloud',
                                                    gridSize: 40,
                                                    sizeRange: [14, 70],
                                                    rotationRange: [-0, 0],
                                                    drawOutOfBound: false,
                                                    layoutAnimation: {
                                                        duration: 2000,
                                                        easing: 'cubicOut'
                                                    },
                                                    textStyle: {
                                                        fontFamily: 'Pretendard, sans-serif',
                                                        fontWeight: 'bold',
                                                        color: function () {
                                                            return colors.positive;
                                                        }
                                                    },
                                                    emphasis: {
                                                        textStyle: {
                                                            shadowBlur: 10,
                                                            shadowColor: 'rgba(0, 0, 0, 0.3)'
                                                        }
                                                    },
                                                    data: wordCloudData
                                                }]
                                            };

                                            // 초기에는 빈 배열로 시작
                                            myChart.setOption({
                                                series: [{
                                                    type: 'wordCloud',
                                                    gridSize: 40,
                                                    sizeRange: [14, 70],
                                                    rotationRange: [-0, 0],
                                                    drawOutOfBound: false,
                                                    textStyle: {
                                                        fontFamily: 'Pretendard, sans-serif',
                                                        fontWeight: 'bold',
                                                        color: function () {
                                                            return colors.positive;
                                                        }
                                                    },
                                                    data: []
                                                }]
                                            }, true);

                                            // 키워드를 순차적으로 추가하여 애니메이션 효과
                                            let currentIndex = 0;
                                            const addKeyword = function () {
                                                if (currentIndex < wordCloudData.length) {
                                                    const currentData = wordCloudData.slice(0, currentIndex + 1);
                                                    myChart.setOption({
                                                        series: [{
                                                            data: currentData,
                                                            animation: true,
                                                            animationDuration: 600,
                                                            animationEasing: 'cubicOut'
                                                        }]
                                                    }, false);
                                                    currentIndex++;
                                                    setTimeout(addKeyword, 40); // 40ms마다 하나씩 추가
                                                } else {
                                                    // 모든 키워드 추가 완료 후 최종 레이아웃 조정
                                                    myChart.setOption(option, false);
                                                }
                                            };

                                            // 약간의 딜레이 후 애니메이션 시작
                                            setTimeout(addKeyword, 200);

                                            window.addEventListener('resize', function () {
                                                myChart.resize();
                                            });

                                            $('.globalNav').on('click', function () {
                                                setTimeout(function () {
                                                    myChart.resize();
                                                }, 300);
                                            });
                                        });
                                    </script>
                                </div>
                            </div>
                        </div>
                        <div class="panel-sub">
                            <div class="row">

                                <div class="column currentSituation min">
                                    <ul class="list-currentSituation type-clean">
                                        <li>
                                            <div class="title-lv1">통화 진행 건 수</div>
                                            <div class="data">
                                                <div class="user-value">
                                                    <span class="counting-value" count-value="2293">0</span>
                                                    <em>건</em>
                                                </div>
                                            </div>
                                        </li>

                                        <li>
                                            <div class="title-lv1">통화 요약 생성 완료 건 수</div>
                                            <div class="data">
                                                <div class="user-value">
                                                    <span class="counting-value" count-value="11">0</span>
                                                    <em>건</em>
                                                </div>
                                            </div>
                                        </li>

                                        <li>
                                            <div class="title-lv1">평균 통화 시간</div>
                                            <div class="data">
                                                <div class="user-value">
                                                    <span class="counting-value" count-value="9237">0</span>
                                                    <em>분</em>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>

                                <div class="column dashboardTable">
                                    <div class="title-lv1">상담사별 통화 분석</div>
                                    <div class="data-mix">
                                        <div class="tbl type-clean">
                                            <div class="tmain">
                                                <table>
                                                    <colgroup>
                                                        <col style="width:60px;">
                                                        <col style="width:100px;">
                                                        <col style="width:auto;">
                                                        <col style="width:200px;">
                                                        <col style="width:200px;">
                                                    </colgroup>
                                                    <thead>
                                                        <tr>
                                                            <th scope="col" class="center">
                                                                상담사
                                                            </th>

                                                            <th scope="col" class="center">
                                                                부서
                                                            </th>
                                                            <th scope="col" class="left">
                                                                발언
                                                            </th>
                                                            <th scope="col" class="center">
                                                                평균 통화 시간
                                                            </th>
                                                            <th scope="col" class="center">
                                                                민원 통화 건수
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td class="center">
                                                                홍길동
                                                            </td>

                                                            <td class="center">
                                                                부서명
                                                            </td>

                                                            <td class="center">
                                                                <b class="text-ellipsis"
                                                                    data-full-text="고객센터에 문의했는데 응대가 너무 느려서 불만이 많습니다. 전화 대기 시간이 길고 상담원 연결까지 시간이 오래 걸려서 답답했습니다.">고객센터에
                                                                    문의했는데 응대가 너무 느려서 불만이 많습니다. 전화 대기 시간이 길고 상담원 연결까지 시간이
                                                                    오래 걸려서 답답했습니다.</b>
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <td class="center">
                                                                홍길동
                                                            </td>

                                                            <td class="center">
                                                                부서명
                                                            </td>

                                                            <td class="left">
                                                                <b class="text-ellipsis"
                                                                    data-full-text="결제 관련해서 문의드렸는데 환불 처리가 너무 늦게 되고 있습니다. 일주일이 지났는데도 진행 상황을 알 수가 없어서 불안합니다.">결제
                                                                    관련해서 문의드렸는데 환불 처리가 너무 늦게 되고 있습니다. 일주일이 지났는데도 진행 상황을
                                                                    알 수가 없어서 불안합니다.</b>
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <td class="center">
                                                                홍길동
                                                            </td>

                                                            <td class="center">
                                                                부서명
                                                            </td>

                                                            <td class="left">
                                                                <b class="text-ellipsis"
                                                                    data-full-text="앱 사용 중 오류가 계속 발생하고 있습니다. 로그인이 안 되거나 화면이 멈추는 현상이 반복되어서 사용하기 어렵습니다.">앱
                                                                    사용 중 오류가 계속 발생하고 있습니다. 로그인이 안 되거나 화면이 멈추는 현상이 반복되어서
                                                                    사용하기 어렵습니다.</b>
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <td class="center">
                                                                홍길동
                                                            </td>

                                                            <td class="center">
                                                                부서명
                                                            </td>

                                                            <td class="left">
                                                                <b class="text-ellipsis"
                                                                    data-full-text="상담원 분이 친절하게 설명해주셔서 감사했습니다. 덕분에 문제를 빠르게 해결할 수 있었고 서비스에 대한 신뢰가 생겼습니다.">상담원
                                                                    분이 친절하게 설명해주셔서 감사했습니다. 덕분에 문제를 빠르게 해결할 수 있었고 서비스에 대한
                                                                    신뢰가 생겼습니다.</b>
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>
                                                        </tr>

                                                        <tr>
                                                            <td class="center">
                                                                홍길동
                                                            </td>

                                                            <td class="center">
                                                                부서명
                                                            </td>

                                                            <td class="left">
                                                                <b class="text-ellipsis"
                                                                    data-full-text="계약 조건이 변경되었는데 사전에 통보를 받지 못했습니다. 변경 사항에 대해 미리 알려주셨으면 좋았을 것 같습니다.">계약
                                                                    조건이 변경되었는데 사전에 통보를 받지 못했습니다. 변경 사항에 대해 미리 알려주셨으면 좋았을
                                                                    것 같습니다.</b>
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>

                                                            <td class="center">
                                                                21
                                                            </td>
                                                        </tr>

                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="tfoot">
                                                <div class="option">&nbsp;</div>
                                                <div class="cmd">
                                                    <span>1-6 of 6</span>
                                                    <div class="pagination">
                                                        <ol>
                                                            <li class="first">
                                                                <a href="#">처음</a>
                                                            </li>
                                                            <li class="prev">
                                                                <a href="#">이전</a>
                                                            </li>
                                                            <li class="on">
                                                                <a href="#">1</a>
                                                            </li>
                                                            <li>
                                                                <a href="#">2</a>
                                                            </li>
                                                            <li>
                                                                <a href="#">3</a>
                                                            </li>
                                                            <li>
                                                                <a href="#">4</a>
                                                            </li>
                                                            <li>
                                                                <a href="#">5</a>
                                                            </li>
                                                            <li class="next">
                                                                <a href="#">다음</a>
                                                            </li>
                                                            <li class="last">
                                                                <a href="#">마지막</a>
                                                            </li>
                                                        </ol>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="/src/js/main.js"></script>
    <script>
        // 텍스트 말줄임표 툴팁 기능
        $(document).ready(function () {
            $('.text-ellipsis').each(function () {
                const $element = $(this);
                const fullText = $element.attr('data-full-text') || $element.text();
                const elementText = $element.text();

                // 텍스트가 잘렸는지 확인
                if (elementText.length === fullText.length && $element[0].scrollWidth <= $element[0].offsetWidth) {
                    return; // 텍스트가 잘리지 않았으면 툴팁 불필요
                }

                // 툴팁 요소 생성
                const $tooltip = $('<div class="tooltip"></div>').text(fullText);
                $tooltip.appendTo('body');

                // 마우스 오버 이벤트
                $element.on('mouseenter', function () {
                    const offset = $element.offset();
                    const elementWidth = $element.outerWidth();
                    const elementHeight = $element.outerHeight();
                    const tooltipWidth = $tooltip.outerWidth();

                    // 툴팁 위치 계산 (요소 아래 중앙)
                    const left = offset.left + (elementWidth / 2) - (tooltipWidth / 2);
                    const top = offset.top + elementHeight + 8; // 8px 간격

                    $tooltip.css({
                        left: left + 'px',
                        top: top + 'px'
                    }).addClass('show');
                });

                $element.on('mouseleave', function () {
                    $tooltip.removeClass('show');
                });

                // 스크롤/리사이즈 시 위치 업데이트
                $(window).on('scroll resize', function () {
                    if ($tooltip.hasClass('show')) {
                        const offset = $element.offset();
                        const elementWidth = $element.outerWidth();
                        const elementHeight = $element.outerHeight();
                        const tooltipWidth = $tooltip.outerWidth();

                        const left = offset.left + (elementWidth / 2) - (tooltipWidth / 2);
                        const top = offset.top + elementHeight + 8;

                        $tooltip.css({
                            left: left + 'px',
                            top: top + 'px'
                        });
                    }
                });
            });
        });
    </script>
</body>

</html>